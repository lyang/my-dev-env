---
- name: "Install Homebrew Casks"
  community.general.homebrew_cask:
    accept_external_apps: yes
    state: latest
    name: "{{HOMEBREW_CASK_PACKAGES}}"

- name: "Install {{ansible_distribution}} Packages"
  ansible.builtin.package:
    state: latest
    name: "{{HOMEBREW_PACKAGES}}"

- name: "Config Shell env"
  ansible.builtin.blockinfile:
    path: "{{ansible_env.HOME}}/{{rc_file}}"
    marker: "#### {mark} ANSIBLE MANAGED BLOCK - {{playbook_dir|basename}}/roles/{{role_name}} ####"
    create: yes
    block: |
      eval "$(/opt/homebrew/bin/brew shellenv)"
      export PATH="$(brew --prefix)/opt/gnu-tar/libexec/gnubin:$PATH"
  loop:
    - .bash_profile
    - .zprofile
  loop_control:
    loop_var: rc_file

